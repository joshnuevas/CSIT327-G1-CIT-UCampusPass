{% extends "dashboard_app/admin_dashboard_base.html" %}
{% load static %}

{% block title %}Admin Profile - CIT-U Campus Pass{% endblock %}
{% block admin_profile_active %}active{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'profile_app/css/admin_profile.css' %}?v={{ now|date:'U' }}">
{% endblock %}

{% block content %}
<div class="welcome-section">
    <h1>Profile Settings</h1>
    <p>Manage your personal information and account security.</p>
</div>

<div class="settings-grid">

    <!-- ================= PERSONAL PROFILE CARD ================= -->
    <div class="settings-card profile-card">
        <div class="card-header-clean">
            <h3>Personal Profile</h3>
            <button type="button" class="btn-edit-outline" id="editBtn">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793
                             L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                </svg>
                Edit Details
            </button>
        </div>

        <!-- VIEW MODE -->
        <div id="viewMode" class="profile-view-wrapper">
            <div class="profile-hero">
                <div class="profile-avatar-circle">
                    {{ admin.first_name|slice:":1" }}{{ admin.last_name|slice:":1" }}
                </div>
                <div class="profile-identity">
                    <h2>{{ admin.first_name }} {{ admin.last_name }}</h2>
                    <span class="badge-role">Administrator</span>
                </div>
            </div>

            <div class="profile-details-grid">
                <div class="detail-item">
                    <span class="detail-label">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        Email Address
                    </span>
                    <span class="detail-value">{{ admin.email }}</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        Username
                    </span>
                    <span class="detail-value">{{ admin.username }}</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 
                                     01-.502 1.21l-2.257 1.13a11.042 11.042 0 
                                     005.516 5.516l1.13-2.257a1 1 0 
                                     011.21-.502l4.493 1.498a1 1 0 
                                     01.684.949V19a2 2 0 01-2 2h-1C9.716 21 
                                     3 14.284 3 6V5z">
                            </path>
                        </svg>
                        Contact Number
                    </span>
                    <span class="detail-value">{{ admin.contact_number }}</span>
                </div>
            </div>
        </div>

        <!-- EDIT MODE -->
        <form method="POST" id="editMode" class="settings-form" style="display: none;">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_info">

            <div class="form-grid-modern">
                <div class="form-group">
                    <label for="firstNameInput">First Name</label>
                    <input type="text" name="first_name" id="firstNameInput"
                           value="{{ admin.first_name }}" required class="input-modern">
                </div>

                <div class="form-group">
                    <label for="lastNameInput">Last Name</label>
                    <input type="text" name="last_name" id="lastNameInput"
                           value="{{ admin.last_name }}" required class="input-modern">
                </div>

                <div class="form-group">
                    <label for="contactNumberInput">Contact Number</label>
                    <input type="text" name="contact_number" id="contactNumberInput"
                           value="{{ admin.contact_number }}" required class="input-modern"
                           pattern="^09\d{9}$"
                           oninvalid="this.setCustomValidity('Please enter a valid contact number (11 digits starting with 09).')"
                           oninput="this.setCustomValidity('')">
                </div>

                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" value="{{ admin.email }}" disabled
                           class="input-modern"
                           style="background-color:#f5f5f5; color:#666; cursor:not-allowed;">
                </div>
            </div>

            <div class="form-actions-clean">
                <button type="button" class="btn-cancel-clean" id="cancelBtn">Cancel</button>
                <button type="submit" class="btn-save-clean">Save Changes</button>
            </div>
        </form>
    </div>

    <!-- ================= DELETE ACCOUNT CARD ================= -->
    <div class="settings-card action-row-card danger-theme">
        <div class="row-content-wrapper">
            <div class="row-icon-box icon-danger">
                <svg width="28" height="28" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                          d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0
                             000 2v10a2 2 0 002 2h8a2 2 0
                             002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1
                             1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0
                             11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0
                             102 0V8a1 1 0 00-1-1z"
                          clip-rule="evenodd" />
                </svg>
            </div>

            <div class="row-info">
                <h3 class="text-danger">Delete Account</h3>
                <p class="row-desc">Permanently remove your account and all associated data.</p>
            </div>

            <div class="row-action">
                <button type="button" class="btn-danger-outline" id="deleteAccountBtn">
                    Delete Account
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ================= CONFIRM DELETE MODAL ================= -->
<div id="confirmDeleteModal" class="modal">
    <div class="modal-content">
        <h2>Confirm Deletion</h2>
        <p>Are you sure you want to delete your account?</p>
        <div class="modal-buttons">
            <button type="button" id="confirmDeleteYes" class="btn-danger-solid">
                Yes, Delete Account
            </button>
            <button type="button" id="confirmDeleteNo" class="btn-secondary">Cancel</button>
        </div>
    </div>
</div>

<!-- ================= PASSWORD CONFIRM MODAL ================= -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <h2>Delete Account</h2>
        <p>Please enter your password to confirm.</p>

        <form method="POST" action="{% url 'profile_app:admin_profile' %}" id="deleteForm">
            {% csrf_token %}
            <input type="hidden" name="action" value="delete_account">

            <div class="form-group full-width">
                <input type="password" name="delete_password"
                       placeholder="Enter your password"
                       required class="input-modern" style="text-align:center;">
            </div>

            <div class="modal-buttons">
                <button type="submit" class="btn-danger-solid">Confirm Delete</button>
                <button type="button" id="cancelDelete" class="btn-secondary">Cancel</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}


{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {

    /* ============================
       ELEMENTS
    ============================ */
    const editBtn = document.getElementById("editBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const viewMode = document.getElementById("viewMode");
    const editMode = document.getElementById("editMode");

    const deleteAccountBtn = document.getElementById("deleteAccountBtn");
    const confirmModal = document.getElementById("confirmDeleteModal");
    const confirmYes = document.getElementById("confirmDeleteYes");
    const confirmNo = document.getElementById("confirmDeleteNo");

    const deleteModal = document.getElementById("deleteModal");
    const cancelDelete = document.getElementById("cancelDelete");

    /* ============================
       EDIT MODE TOGGLE
    ============================ */
    editBtn.addEventListener("click", () => {
        viewMode.style.display = "none";
        editMode.style.display = "block";
        editBtn.style.display = "none";
    });

    cancelBtn.addEventListener("click", () => {
        editMode.reset();
        viewMode.style.display = "block";
        editMode.style.display = "none";
        editBtn.style.display = "inline-flex";
    });

    /* ============================
       DELETE ACCOUNT FLOW
       1. Click delete → confirm modal
       2. Yes → open password modal
    ============================ */

    deleteAccountBtn.addEventListener("click", () => {
        confirmModal.style.display = "flex";
    });

    confirmYes.addEventListener("click", () => {
        confirmModal.style.display = "none";
        deleteModal.style.display = "flex";
    });

    confirmNo.addEventListener("click", () => {
        confirmModal.style.display = "none";
    });

    cancelDelete.addEventListener("click", () => {
        deleteModal.style.display = "none";
    });

    /* ============================
       CLICK OUTSIDE TO CLOSE
    ============================ */
    window.addEventListener("click", (e) => {
        if (e.target === confirmModal) confirmModal.style.display = "none";
        if (e.target === deleteModal) deleteModal.style.display = "none";
    });

    /* ============================
       AUTO-DISMISS ALERTS
    ============================ */
    document.querySelectorAll(".alert").forEach(alert => {
        setTimeout(() => {
            alert.style.opacity = "0";
            alert.style.transform = "translateX(40px)";
            setTimeout(() => alert.remove(), 400);
        }, 5000);
    });

});
</script>
{% endblock %}
