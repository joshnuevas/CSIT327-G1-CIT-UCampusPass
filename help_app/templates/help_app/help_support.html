{% extends "dashboard_app/visitor_dashboard_base.html" %}
{% load static %}
{% block title %}Help & Support - CIT-U Campus Pass{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'help_app/css/help_support.css' %}?v={{ now|date:'U' }}">
{% endblock %}

{% block help_active %}active{% endblock %}

{% block content %}
<div class="welcome-section">
    <h1>Help & Support</h1>
    <p>Find answers to common questions or get in touch with us</p>
</div>

<!-- Messages -->
{% if messages %}
    <div class="messages-container">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}

<!-- Quick Navigation -->
<div class="quick-nav-grid">
    <a href="#faqs" class="quick-nav-card">
        <div class="nav-card-icon">‚ùì</div>
        <h3>FAQs</h3>
        <p>Common questions answered</p>
    </a>
    <a href="#contact" class="quick-nav-card">
        <div class="nav-card-icon">üìß</div>
        <h3>Contact Us</h3>
        <p>Send us a message</p>
    </a>
    <a href="#troubleshooting" class="quick-nav-card">
        <div class="nav-card-icon">üîß</div>
        <h3>Troubleshooting</h3>
        <p>Fix common issues</p>
    </a>
    <a href="#feedback" class="quick-nav-card">
        <div class="nav-card-icon">üí°</div>
        <h3>Feedback</h3>
        <p>Share your suggestions</p>
    </a>
</div>

<!-- FAQs Section -->
<div id="faqs" class="card">
    <div class="card-header">
        <h3 class="card-title">Frequently Asked Questions</h3>
    </div>

    <div class="accordion">
        <!-- FAQ 1 -->
        <div class="accordion-item">
            <button class="accordion-header">
                <span>How do I book a visit?</span>
                <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-content">
                <p>Booking a visit is simple:</p>
                <ol>
                    <li>Go to the <strong>Book Visit</strong> page from the sidebar</li>
                    <li>Select your <strong>purpose</strong> (or enter a custom purpose)</li>
                    <li>Choose the <strong>department</strong> you wish to visit</li>
                    <li>Pick your preferred <strong>date</strong> (weekdays only)</li>
                    <li>Select <strong>start and end times</strong> between 7:30 AM - 9:00 PM</li>
                    <li>Click <strong>Submit</strong> to receive your unique visit code</li>
                </ol>
                <p>You'll receive a confirmation with your visit code.</p>
            </div>
        </div>

        <!-- FAQ 2 -->
        <div class="accordion-item">
            <button class="accordion-header">
                <span>How do I cancel or reschedule a visit?</span>
                <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-content">
                <p>To cancel or reschedule your visit:</p>
                <ol>
                    <li>Go to your <strong>Dashboard</strong> or <strong>My History</strong> page</li>
                    <li>Find the visit you want to modify</li>
                    <li>Click the <strong>Cancel</strong> button for upcoming visits</li>
                    <li>To reschedule, cancel the existing visit and book a new one</li>
                </ol>
                <p><strong>Note:</strong> Cancellations should be made at least 24 hours before your scheduled visit.</p>
            </div>
        </div>

        <!-- FAQ 3 -->
        <div class="accordion-item">
            <button class="accordion-header">
                <span>Why can't I see my visit on the dashboard?</span>
                <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-content">
                <p>If your visit isn't showing up, try these steps:</p>
                <ul>
                    <li><strong>Refresh the page</strong> - Press F5 or click refresh</li>
                    <li><strong>Check My History</strong> - Past visits appear there</li>
                    <li><strong>Verify booking</strong> - Make sure you got a success message</li>
                    <li><strong>Clear cache</strong> - Sometimes cached data needs clearing</li>
                    <li><strong>Log out and back in</strong> - This refreshes your session</li>
                </ul>
                <p>If the problem persists, please <a href="#contact">contact support</a>.</p>
            </div>
        </div>

        <!-- FAQ 4 -->
        <div class="accordion-item">
            <button class="accordion-header">
                <span>How can I reset my password?</span>
                <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-content">
                <p>To reset your password:</p>
                <ol>
                    <li>Go to the <strong>Login</strong> page</li>
                    <li>Click on <strong>"Forgot Password?"</strong></li>
                    <li>Enter your registered email address</li>
                    <li>Check your email for a password reset link</li>
                    <li>Follow the instructions to create a new password</li>
                </ol>
                <p>Check your spam folder if you don't receive the email within 5 minutes.</p>
            </div>
        </div>

        <!-- FAQ 5 -->
        <div class="accordion-item">
            <button class="accordion-header">
                <span>What should I do if I didn't receive a confirmation email?</span>
                <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-content">
                <p>Don't worry! Your visit is still booked even without the email.</p>
                <ul>
                    <li><strong>Check spam folder</strong> - Emails sometimes land there</li>
                    <li><strong>View your code</strong> - It's displayed after booking</li>
                    <li><strong>Check Dashboard</strong> - Your visit details are saved there</li>
                    <li><strong>Note your code</strong> - You'll need it upon arrival</li>
                </ul>
                <p>The email is optional - as long as you have your visit code, you're set!</p>
            </div>
        </div>

        <!-- FAQ 6 -->
        <div class="accordion-item">
            <button class="accordion-header">
                <span>What are the visiting hours?</span>
                <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-content">
                <p>CIT-U CampusPass visiting schedule:</p>
                <ul>
                    <li><strong>Days:</strong> Monday to Friday (Weekdays only)</li>
                    <li><strong>Times:</strong> 7:30 AM to 9:00 PM</li>
                    <li><strong>Weekends:</strong> Not available on Saturdays and Sundays</li>
                </ul>
                <p><strong>Important:</strong> All visit times must fall within this window.</p>
            </div>
        </div>

        <!-- FAQ 7 -->
        <div class="accordion-item">
            <button class="accordion-header">
                <span>What should I bring when visiting?</span>
                <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-content">
                <p>Please bring:</p>
                <ul>
                    <li><strong>Valid ID</strong> - Government-issued or school ID</li>
                    <li><strong>Visit Code</strong> - The code from your booking</li>
                    <li><strong>Purpose Documentation</strong> - If applicable</li>
                </ul>
                <p>Present your visit code to security at the entrance.</p>
            </div>
        </div>
    </div>
</div>

<!-- Troubleshooting Section -->
<div id="troubleshooting" class="card">
    <div class="card-header">
        <h3 class="card-title">Troubleshooting</h3>
    </div>
    <div class="troubleshooting-grid">
        <div class="troubleshooting-item">
            <div class="trouble-icon">üîÑ</div>
            <h4>Pages not loading?</h4>
            <p>Clear your browser cache. Press <kbd>Ctrl+Shift+Delete</kbd> and select cached images and files.</p>
        </div>

        <div class="troubleshooting-item">
            <div class="trouble-icon">üì∂</div>
            <h4>Connection issues?</h4>
            <p>Check your internet connection. Try switching between WiFi and mobile data.</p>
        </div>

        <div class="troubleshooting-item">
            <div class="trouble-icon">üîê</div>
            <h4>Session expired?</h4>
            <p>For security, sessions expire after inactivity. Simply log in again.</p>
        </div>

        <div class="troubleshooting-item">
            <div class="trouble-icon">üñ•Ô∏è</div>
            <h4>Display issues?</h4>
            <p>Try a different browser or update your current one to the latest version.</p>
        </div>
    </div>
</div>

<!-- Contact & Feedback Grid -->
<div class="contact-feedback-grid">
    <!-- Contact Section -->
    <div id="contact" class="card">
        <div class="card-header">
            <h3 class="card-title">Contact Support</h3>
        </div>

        <div class="contact-info-box">
            <div class="contact-method">
                <span class="method-icon">üìß</span>
                <div>
                    <strong>Email</strong>
                    <p><a href="mailto:citucampuspass@gmail.com">citucampuspass@gmail.com</a></p>
                </div>
            </div>
            <div class="contact-method">
                <span class="method-icon">‚è∞</span>
                <div>
                    <strong>Response Time</strong>
                    <p>Within 24-48 hours</p>
                </div>
            </div>
        </div>

        <form method="POST" class="support-form">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="contact">

            <div class="form-group">
                <label>Full Name <span class="required">*</span></label>
                <input type="text" name="name" value="{{ user_first_name }}" required>
            </div>

            <div class="form-group">
                <label>Email <span class="required">*</span></label>
                <input type="email" name="email" value="{{ user_email }}" required>
            </div>

            <div class="form-group">
                <label>Subject <span class="required">*</span></label>
                <select name="subject" required>
                    <option value="">Select a subject</option>
                    <option value="Booking Issue">Booking Issue</option>
                    <option value="Cannot Login">Cannot Login</option>
                    <option value="Technical Problem">Technical Problem</option>
                    <option value="Visit Code Issue">Visit Code Issue</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label>Message <span class="required">*</span></label>
                <textarea name="message" rows="4" required></textarea>
            </div>

            <button type="submit" class="submit-btn">Send Message</button>
        </form>
    </div>

    <!-- Feedback Section -->
    <div id="feedback" class="card feedback-card">
        <div class="card-header">
            <h3 class="card-title">Share Your Feedback</h3>
        </div>

        <div class="feedback-intro">
            <div class="feedback-icon">üí°</div>
            <p>Have ideas to improve CampusPass? We'd love to hear from you!</p>
        </div>

        <form method="POST" class="support-form">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="feedback">

            <div class="form-group">
                <label>Name <span class="required">*</span></label>
                <input type="text" name="name" value="{{ user_first_name }}" required>
            </div>

            <div class="form-group">
                <label>Email <span class="required">*</span></label>
                <input type="email" name="email" value="{{ user_email }}" required>
            </div>

            <div class="form-group">
                <label>Your Feedback <span class="required">*</span></label>
                <textarea name="message" rows="4" placeholder="Share your suggestions..." required></textarea>
            </div>

            <button type="submit" class="submit-btn feedback-btn">Submit Feedback</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Accordion functionality
document.querySelectorAll('.accordion-header').forEach(button => {
    button.addEventListener('click', () => {
        const accordionItem = button.parentElement;
        const isActive = accordionItem.classList.contains('active');

        document.querySelectorAll('.accordion-item').forEach(item => {
            item.classList.remove('active');
            item.querySelector('.accordion-icon').textContent = '+';
        });

        if (!isActive) {
            accordionItem.classList.add('active');
            button.querySelector('.accordion-icon').textContent = '‚àí';
        }
    });
});

// Smooth scrolling
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });
});

// Auto-dismiss messages
setTimeout(() => {
    document.querySelectorAll('.alert').forEach(msg => {
        msg.style.transition = 'opacity 0.5s';
        msg.style.opacity = '0';
        setTimeout(() => msg.remove(), 500);
    });
}, 5000);
</script>
{% endblock %}