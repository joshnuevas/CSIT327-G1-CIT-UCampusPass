{% extends "dashboard_app/visitor_dashboard_base.html" %}
{% load static %}
{% block title %}Help & Support - CIT-U Campus Pass{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'help_app/css/help_support.css' %}?v={{ now|date:'U' }}">
{% endblock %}

{% block help_active %}active{% endblock %}

{% block content %}
<div class="page-hero-bg"></div>

<div class="content-wrapper">
    <div class="welcome-section">
        <div class="welcome-text">
            <h1>Help Center</h1>
            <p>Guides, troubleshooting, and answers to common questions.</p>
        </div>
    </div>

    {% if messages %}
        <div class="messages-container">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/></svg>
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="quick-nav-grid">
        <a href="#faqs" class="nav-card">
            <div class="nav-icon-circle icon-faq">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </div>
            <div class="nav-text">
                <h3>FAQs</h3>
                <p>Common questions answered</p>
            </div>
        </a>
        <a href="#troubleshooting" class="nav-card">
            <div class="nav-icon-circle icon-trouble">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
            </div>
            <div class="nav-text">
                <h3>Troubleshooting</h3>
                <p>Fix technical issues</p>
            </div>
        </a>
    </div>

    <div id="faqs" class="content-card">
        <div class="card-header-clean">
            <h3 class="card-title">Frequently Asked Questions</h3>
        </div>

        <div class="accordion">
            <div class="accordion-item">
                <button class="accordion-header">
                    <span class="q-text">How do I book a visit?</span>
                    <span class="accordion-icon"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></span>
                </button>
                <div class="accordion-content">
                    <div class="content-pad">
                        <ol class="steps-list">
                            <li>Navigate to the <strong>Book Visit</strong> page.</li>
                            <li>Select your <strong>Target Department</strong> and <strong>Purpose</strong>.</li>
                            <li>Choose a valid <strong>Date</strong> (Mon-Sat).</li>
                            <li>Click <strong>Confirm &amp; Book Visit</strong>.</li>
                        </ol>
                        <p class="note-text">Your visit code will appear instantly on your Dashboard.</p>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-header">
                    <span class="q-text">How do I cancel or reschedule?</span>
                    <span class="accordion-icon"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></span>
                </button>
                <div class="accordion-content">
                    <div class="content-pad">
                        <p>Go to <strong>My History</strong> or the <strong>Homepage Dashboard</strong>, find the upcoming visit card, tap it to flip, and click <strong>Cancel Booking</strong>.</p>
                        <p>To reschedule, simply book a new visit after cancelling the old one.</p>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-header">
                    <span class="q-text">My visit isn't showing on the dashboard.</span>
                    <span class="accordion-icon"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></span>
                </button>
                <div class="accordion-content">
                    <div class="content-pad">
                        <p>Try refreshing the page or checking the <strong>My History</strong> tab. Ensure you are looking at the correct date filter.</p>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-header">
                    <span class="q-text">How can I reset my password?</span>
                    <span class="accordion-icon"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></span>
                </button>
                <div class="accordion-content">
                    <div class="content-pad">
                        <p>Log out and click <strong>"Forgot Password?"</strong> on the login screen. Follow the email instructions sent to your registered address.</p>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-header">
                    <span class="q-text">What do I need to bring during my visit?</span>
                    <span class="accordion-icon">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </span>
                </button>
                <div class="accordion-content">
                    <div class="content-pad">
                        <ul class="bullet-list">
                            <li><strong>Valid official ID with photo</strong> (e.g., school ID, company ID, or government-issued ID).</li>
                            <li><strong>Your visit code or QR code</strong> from the Campus Pass (shown on your Dashboard or in <strong>My History</strong>).</li>
                            <li>Any <strong>supporting documents</strong> requested by the department you are visiting.</li>
                        </ul>
                        <p class="note-text">Make sure the information on your booking matches the details on your ID for a smooth gate check-in.</p>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-header">
                    <span class="q-text">What are the visiting hours?</span>
                    <span class="accordion-icon"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></span>
                </button>
                <div class="accordion-content">
                    <div class="content-pad">
                        <ul class="bullet-list">
                            <li><strong>Monday - Saturday:</strong> 7:30 AM to 9:00 PM</li>
                            <li><strong>Sundays/Holidays:</strong> Closed (unless announced)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="troubleshooting" class="content-card">
    <div class="card-header-clean">
        <h3 class="card-title">Troubleshooting Guide</h3>
    </div>
    <div class="troubleshooting-grid">
        <div class="trouble-card">
            <div class="trouble-icon bg-blue">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
            </div>
            <h4>Page Won't Load?</h4>
            <p>Clear your browser cache (Ctrl+Shift+R) or try a different browser.</p>
        </div>

        <div class="trouble-card">
            <div class="trouble-icon bg-green">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
                </svg>
            </div>
            <h4>Connection Error?</h4>
            <p>Check your internet connection. Switch between WiFi and mobile data.</p>
        </div>

        <div class="trouble-card">
            <div class="trouble-icon bg-gold">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
            </div>
            <h4>Session Expired?</h4>
            <p>For security, you are logged out after inactivity. Please log in again.</p>
        </div>

        <div class="trouble-card">
            <div class="trouble-icon bg-gray">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
            </div>
            <h4>Display Glitches?</h4>
            <p>Update your browser to the latest version for the best experience.</p>
        </div>

        <div class="trouble-card">
            <div class="trouble-icon bg-blue">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M8 7V5a3 3 0 013-3h2a3 3 0 013 3v2m-1 4h-8a2 2 0 00-2 2v5h12v-5a2 2 0 00-2-2z"></path>
                </svg>
            </div>
            <h4>Wrong Visit Details?</h4>
            <p>Cancel the incorrect booking in <strong>My History</strong> and create a new visit with updated details.</p>
        </div>

        <div class="trouble-card">
            <div class="trouble-icon bg-green">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 11c1.657 0 3-1.343 3-3S13.657 5 12 5 9 6.343 9 8s1.343 3 3 3zm0 2c-2.21 0-4 1.343-4 3v1h8v-1c0-1.657-1.79-3-4-3zM15 3h4m0 0v4m0-4l-5 5"></path>
                </svg>
            </div>
            <h4>Visit Code Not Working?</h4>
            <p>Verify the code from your Dashboard/My History. If it still fails, present your ID and coordinate with campus staff.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Accordion Logic
document.querySelectorAll('.accordion-header').forEach(button => {
    button.addEventListener('click', () => {
        const item = button.parentElement;
        const isActive = item.classList.contains('active');

        // Close all others
        document.querySelectorAll('.accordion-item').forEach(i => {
            i.classList.remove('active');
        });

        // Toggle current
        if (!isActive) {
            item.classList.add('active');
        }
    });
});

// Smooth Scroll
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        document.querySelector(this.getAttribute('href')).scrollIntoView({
            behavior: 'smooth', block: 'start'
        });
    });
});

// Dismiss Alerts
setTimeout(() => {
    document.querySelectorAll('.alert').forEach(msg => {
        msg.style.opacity = '0';
        setTimeout(() => msg.remove(), 500);
    });
}, 5000);
</script>
{% endblock %}
