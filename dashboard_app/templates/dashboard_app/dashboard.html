{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIT-U Campus Pass - Dashboard</title>
    <link rel="stylesheet" href="{% static 'dashboard_app/css/dashboard.css' %}?v={{ now|date:'U' }}">
    <style>
        /* ===== Modal Styles ===== */
        .modal {
            display: none; 
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.45);
            backdrop-filter: blur(3px);
            animation: fadeIn 0.3s ease forwards;
        }
        .modal-content {
            background: linear-gradient(135deg, #fff8f5, #fff1e5);
            margin: 15% auto;
            padding: 35px 25px;
            border-radius: 25px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 15px 50px rgba(139, 21, 56, 0.3);
            transform: translateY(-20px);
            animation: slideDown 0.4s ease forwards;
        }
        .modal-content h2 {
            color: #8B1538;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 25px;
            letter-spacing: 0.5px;
        }
        .modal-content button {
            padding: 14px 30px;
            background: linear-gradient(135deg, #8B1538, #6B0F2A);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(139, 21, 56, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin: 5px;
        }
        .modal-content button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 21, 56, 0.35);
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="school-logo"></div>
        <div class="sidebar-header">
            <h2>CIT-U Campus Pass</h2>
            <p>Visitor Management</p>
        </div>
        <nav class="nav-menu">
            <a href="{% url 'dashboard' %}" class="nav-item active">
                <svg fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                </svg>
                Dashboard
            </a>

            <a href="#" class="nav-item">
                <svg fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                </svg>
                My Passes
            </a>

            <a href="{% url 'book_visit' %}" class="nav-item">
                <svg fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                </svg>
                Book a Visit
            </a>

            <a href="{% url 'visit_history' %}" class="nav-item">
                <svg fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                </svg>
                Visit History
            </a>

            <div class="nav-divider"></div>

            <a href="#" class="nav-item">
                <svg fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
                </svg>
                Notifications
            </a>

            <a href="#" class="nav-item">
                <svg fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
                </svg>
                Help & Support
            </a>

            <a href="#" class="nav-item">
                <svg fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                </svg>
                Profile Settings
            </a>

            <a href="#" class="nav-item logout-item" id="logoutBtn">
                <svg fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/>
                </svg>
                Logout
            </a>
        </nav>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <div class="search-bar">
                <input type="text" placeholder="Search passes, visits...">
            </div>
            <div class="user-info">
                <div class="notification-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    {% if notifications|length > 0 %}
                        <span class="notification-badge">{{ notifications|length }}</span>
                    {% endif %}
                </div>
                <div class="user-avatar">{{ user_first_name|default:"JD"|slice:":2"|upper }}</div>
            </div>
        </div>

        <div class="content-area">
            <div class="welcome-section">
                <h1>Welcome, {{ user_first_name }}!</h1>
                <p>Here's what's happening with your campus visits today</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card active-pass-stat">
                    <div class="stat-value">{{ active_visits|length }}</div>
                    <div class="stat-label">Active Pass</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">{{ upcoming_visits|length }}</div>
                    <div class="stat-label">Upcoming Visits</div>
                </div>
                <div class="stat-card total-visits-stat">
                    <div class="stat-value">{{ total_visits }}</div>
                    <div class="stat-label">Total Visits</div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">My Visit Codes</h3>
                        <a href="#" class="view-all">View All →</a>
                    </div>

                    {% now "Y-m-d" as today %}
                    {% for visit in visits %}
                        <div class="pass-code-item">
                            <div class="pass-code-info">
                                <h4>{{ visit.code }}</h4>
                                <p>{{ visit.display_date }} • {{ visit.formatted_start_time }} - {{ visit.formatted_end_time }} • {{ visit.purpose }}</p>
                            </div>
                            <span class="pass-status status-{{ visit.status|lower }}">{{ visit.status }}</span>
                        </div>
                    {% empty %}
                        <p>No visits found.</p>
                    {% endfor %}

                    <div style="margin-top: 20px;">
                        <a href="{% url 'book_visit' %}" class="quick-action-btn">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                            </svg>
                            Book New Visit
                        </a>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Notifications</h3>
                    </div>

                    {% for notif in notifications %}
                        <div class="notification-item">
                            <div class="notification-icon-small">
                                <svg width="18" height="18" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="notification-content">
                                <h4>{{ notif.title }}</h4>
                                <p>{{ notif.message }}</p>
                                <div class="notification-time">{{ notif.timestamp|timesince }} ago</div>
                            </div>
                        </div>
                    {% empty %}
                        <p>No notifications.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- ===== Login Success Modal ===== -->
    {% for message in messages %}
        {% if 'login-success' in message.tags %}
            <div id="successModal" class="modal">
                <div class="modal-content">
                    <h2>{{ message }}</h2>
                    <button id="continueBtn">Continue</button>
                </div>
            </div>
        {% endif %}
    {% endfor %}

    <!-- ===== Logout Confirmation Modal ===== -->
    <div id="logoutModal" class="modal">
        <div class="modal-content">
            <h2>Are you sure you want to logout?</h2>
            <button id="confirmLogout">Logout</button>
            <button id="cancelLogout">Cancel</button>
        </div>
    </div>

    <script>
        // ===== Login Success Modal =====
        window.onload = function() {
            const successModal = document.getElementById('successModal');
            const continueBtn = document.getElementById('continueBtn');

            if(successModal){
                successModal.style.display = 'block';
                continueBtn.onclick = function() {
                    successModal.style.display = 'none';
                }
                window.onclick = function(e) {
                    if(e.target == successModal) successModal.style.display = 'none';
                }
            }
        }

        // ===== Logout Confirmation Modal =====
        const logoutBtn = document.getElementById('logoutBtn');
        const logoutModal = document.getElementById('logoutModal');
        const confirmLogout = document.getElementById('confirmLogout');
        const cancelLogout = document.getElementById('cancelLogout');

        logoutBtn.onclick = function(e) {
            e.preventDefault(); // prevent immediate logout
            logoutModal.style.display = 'block';
        }

        confirmLogout.onclick = function() {
            window.location.href = "{% url 'logout' %}"; // perform logout
        }

        cancelLogout.onclick = function() {
            logoutModal.style.display = 'none';
        }

        window.onclick = function(e) {
            if(e.target == logoutModal) logoutModal.style.display = 'none';
        }
    </script>
</body>
</html>