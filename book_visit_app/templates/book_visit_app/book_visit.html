{% extends "dashboard_app/visitor_dashboard_base.html" %}
{% load static %}

{% block title %}CIT-U Campus Pass - Book a Visit{% endblock %}

{% block book_visit_active %}active{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'book_visit_app/css/book_visit.css' %}?v={% now 'U' %}">
{% endblock %}

{% block content %}
<div class="page-hero-bg"></div> 

<div class="content-wrapper">
    <div class="welcome-section">
        <div class="welcome-text">
            <h1>Schedule a Campus Visit</h1>
            <p>Complete the form below to secure your entry pass.</p>
        </div>
    </div>

    <div class="booking-card">
        <div class="card-header-accent">
            <div class="header-content">
                <div class="header-icon-circle">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <div class="header-text">
                    <h2>New Visit Request</h2>
                    <span>Please ensure all details are accurate</span>
                </div>
            </div>
        </div>

        <form method="POST" action="{% url 'book_visit_app:book_visit' %}" class="booking-form">
            {% csrf_token %}

            <div class="form-layout-grid">
                <div class="form-group">
                    <label for="department" class="required-label">Target Department / Office</label>
                    <div class="select-wrapper">
                        <select name="department" id="department" onchange="updatePurposeOptions(); toggleOther('department')" required>
                            <option value="" selected disabled>Select Department</option>
                            <option value="Alumni Affairs Office (AAO)">Alumni Affairs Office (AAO)</option>
                            <option value="Basic Education Department (BED)">Basic Education Department (BED)</option>
                            <option value="Cashier's Office">Cashier's Office</option>
                            <option value="Center for Community Extension (CCE)">Center for Community Extension (CCE)</option>
                            <option value="Center for Research and Development (CRD)">Center for Research and Development (CRD)</option>
                            <option value="Center for Teaching and Learning (CTL)">Center for Teaching and Learning (CTL)</option>
                            <option value="Clinic / Health Services Office">Clinic / Health Services Office</option>
                            <option value="College of Arts, Sciences and Education (CASE)">College of Arts, Sciences and Education (CASE)</option>
                            <option value="College of Computer Studies (CCS)">College of Computer Studies (CCS)</option>
                            <option value="College of Criminal Justice (CCJ)">College of Criminal Justice (CCJ)</option>
                            <option value="College of Engineering and Architecture (CEA)">College of Engineering and Architecture (CEA)</option>
                            <option value="College of Management, Business and Accountancy (CMBA)">College of Management, Business and Accountancy (CMBA)</option>
                            <option value="College of Nursing and Allied Health Sciences (CNAHS)">College of Nursing and Allied Health Sciences (CNAHS)</option>
                            <option value="Curriculum and Instruction Office (CIO)">Curriculum and Instruction Office (CIO)</option>
                            <option value="Finance and Accounting Office (FAO)">Finance and Accounting Office (FAO)</option>
                            <option value="Guidance Services Office (GSO)">Guidance Services Office (GSO)</option>
                            <option value="Human Resource Department (HRD)">Human Resource Department (HRD)</option>
                            <option value="ICT / MIS Office">ICT / MIS Office</option>
                            <option value="Industry-Academe Linkage Office (IALO)">Industry-Academe Linkage Office (IALO)</option>
                            <option value="Institutional Planning and Development Office (IPDO)">Institutional Planning and Development Office (IPDO)</option>
                            <option value="Internal Audit Office (IAO)">Internal Audit Office (IAO)</option>
                            <option value="Janitorial Services Office">Janitorial Services Office</option>
                            <option value="Learning Resource and Activity Center (LRAC)">Learning Resource and Activity Center (LRAC)</option>
                            <option value="Maintenance Office">Maintenance Office</option>
                            <option value="Networking, Linkages & Relations (NLR)">Networking, Linkages & Relations (NLR)</option>
                            <option value="Office of Admissions and Scholarships (OAS)">Office of Admissions and Scholarships (OAS)</option>
                            <option value="Office of Student Affairs (OSA)">Office of Student Affairs (OSA)</option>
                            <option value="Office of Student Discipline (OSD)">Office of Student Discipline (OSD)</option>
                            <option value="Office of the Executive Vice President">Office of the Executive Vice President</option>
                            <option value="Office of the University President">Office of the University President</option>
                            <option value="Office of the VP for Academic Affairs (VPAA)">Office of the VP for Academic Affairs (VPAA)</option>
                            <option value="Office of the VP for Administration (VPA)">Office of the VP for Administration (VPA)</option>
                            <option value="Office of the VP for External Affairs (VPEA)">Office of the VP for External Affairs (VPEA)</option>
                            <option value="Office of the VP for Finance (VPF)">Office of the VP for Finance (VPF)</option>
                            <option value="Physical Plant Office (PPO)">Physical Plant Office (PPO)</option>
                            <option value="Property and Supply Office (PSO)">Property and Supply Office (PSO)</option>
                            <option value="Public Relations and Communications Office (PRCO)">Public Relations and Communications Office (PRCO)</option>
                            <option value="Purchasing Office">Purchasing Office</option>
                            <option value="Quality Assurance Office (QAO)">Quality Assurance Office (QAO)</option>
                            <option value="Security Office">Security Office</option>
                            <option value="Senior High School Department">Senior High School Department</option>
                            <option value="Student Success Office (SSO)">Student Success Office (SSO)</option>
                            <option value="Technology Business Incubation Office (TBI Office)">Technology Business Incubation Office (TBI Office)</option>
                            <option value="University Registrar's Office (URO)">University Registrar's Office (URO)</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <input type="text" name="department_other" id="department_other" placeholder="Please specify department name" class="input-modern" style="display:none; margin-top: 10px;">
                </div>

                <div class="form-group">
                    <label for="purpose" class="required-label">Purpose of Visit</label>
                    <div class="select-wrapper">
                        <select name="purpose" id="purpose" required>
                            <option value="" selected disabled>Select Department First</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="visit_date" class="required-label">Date of Visit</label>
                    <input type="date"
                        name="visit_date"
                        id="visit_date"
                        class="input-modern"
                        required
                        value="{{ prefill_date|default:'' }}">
                    <p class="helper-text">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Visits available Monday - Saturday. Max 7 days in advance.
                    </p>
                </div>
            </div>

            <div class="form-actions-row">
                <button type="submit" id="submitBtn" class="btn-submit-booking">
                    Confirm & Book Visit
                </button>
            </div>
        </form>
    </div>
</div>

<div id="warningModal" class="modal">
    <div class="modal-content warning-card">
        <div class="warning-icon-wrapper">
            <svg width="40" height="40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
        </div>
        <h2 id="warningTitle">Attention Needed</h2>
        <p id="warningMessage">There was an issue with your selection.</p>
        <button id="warningOkBtn" class="btn-warning-action">Understood</button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// ===== PURPOSE OPTIONS MAPPING =====
const purposeOptions = {
    // üéì ACADEMIC COLLEGES / DEPARTMENTS
    "College of Engineering and Architecture (CEA)": ["Consultation with Dean or Program Chair", "Course / Curriculum Advising", "Laboratory / Facilities Visit", "Thesis / Capstone Consultation", "Student Organization Activity", "Industry / Project Coordination Meeting", "Parent / Guardian Conference", "Other"],
    "College of Computer Studies (CCS)": ["IT / CS Program Inquiry", "Capstone / Thesis Consultation", "Laboratory / Server Room Appointment", "Internship / OJT Coordination", "Faculty Consultation", "Student Organization / Event Meeting", "Parent / Guardian Conference", "Other"],
    "College of Management, Business and Accountancy (CMBA)": ["Business Program Inquiry", "Academic Advising / Retention Consultation", "Thesis / Feasibility Study Consultation", "Internship / Practicum Coordination", "Industry Partner Meeting", "Parent / Guardian Conference", "Other"],
    "College of Arts, Sciences and Education (CASE)": ["Program Inquiry (Liberal Arts / Education)", "Practice Teaching / OJT Coordination", "Research / Thesis Consultation", "Licensure Exam Review / Advising", "Faculty or Chairperson Consultation", "Parent / Guardian Conference", "Other"],
    "College of Nursing and Allied Health Sciences (CNAHS)": ["Nursing / Allied Health Program Inquiry", "Clinical Duty / Hospital Affiliation Concerns", "Clinical Requirements Submission", "Licensure Exam Preparation Consultation", "Faculty / Dean Consultation", "Parent / Guardian Conference", "Other"],
    "College of Criminal Justice (CCJ)": ["Criminology Program Inquiry", "Internship / OJT Coordination", "MOCK Board / Training Concerns", "Research / Thesis Consultation", "Faculty / Dean Consultation", "Parent / Guardian Conference", "Other"],
    "Senior High School Department": ["SHS Enrollment or Strand Inquiry", "Parent‚ÄìTeacher Conference", "Clearance / Requirements Submission", "Guidance or Academic Advising", "Discipline or Behavioral Conference", "SHS Events / Activities Meeting", "Other"],
    "Basic Education Department (BED)": ["Grade School / JHS Enrollment Inquiry", "Parent‚ÄìTeacher Conference", "Student Academic Performance Consultation", "Clearance / Requirements Submission", "Discipline / Behavior Concerns", "BED Events / Activities Meeting", "Other"],

    // üè´ ACADEMIC SUPPORT UNITS
    "Learning Resource and Activity Center (LRAC)": ["Library Access / Reading", "Book Borrowing / Returning", "Library Clearance / Account Concerns", "Research Assistance / Database Orientation", "Use of Study Rooms / Facilities", "Access to Archives / Special Collections", "Other"],
    "Student Success Office (SSO)": ["Counseling Appointment", "Career Guidance / Job Placement", "Academic Advising", "Student Intervention / Retention Meeting", "Student Organization / Leader Consultation", "Mental Health Support Session", "Other"],
    "Office of Student Affairs (OSA)": ["Student Organization Accreditation / Concerns", "Campus Activities / Events Approval", "Student Affairs Consultation", "Student Conduct / Behavior Concerns", "Scholarship / Financial Assistance Endorsement", "Other"],
    "Office of Student Discipline (OSD)": ["Discipline Conference / Hearing", "Incident / Case Follow-up", "Parent / Guardian Conference", "Submission of Incident-Related Documents", "Policy Clarification or Orientation", "Other"],
    "Curriculum and Instruction Office (CIO)": ["Curriculum Consultation / Alignment", "Instructional Materials Submission / Review", "Faculty Teaching Load or Assignment Inquiry", "Program / Course Revision Meeting", "Accreditation / CHED Compliance Coordination", "Other"],
    "Center for Teaching and Learning (CTL)": ["Teaching Innovation Consultation", "Faculty Training / Workshop", "Classroom Observation / Feedback Session", "Learning Materials Development Meeting", "Coaching / Mentoring Session", "Other"],
    "Center for Research and Development (CRD)": ["Research Proposal Consultation", "Ethics Review Coordination", "Data Gathering / Survey Permission", "Research Funding / Grant Inquiry", "Journal Publication / Conference Inquiry", "Other"],
    "Center for Community Extension (CCE)": ["Community Extension Project Meeting", "Partner LGU / NGO Coordination", "Outreach Activity Planning", "Monitoring and Evaluation Visit", "Volunteer / Participation Inquiry", "Other"],
    "Guidance Services Office (GSO)": ["Guidance / Counseling Session", "Psychological Testing / Assessment", "Career and Life Planning Consultation", "Parent / Guardian Conference", "Student Follow-up Session", "Other"],

    // üß≠ ADMINISTRATIVE AND FINANCE OFFICES
    "Office of Admissions and Scholarships (OAS)": ["Admission Inquiry", "Submission of Admission Requirements", "Enrollment Processing", "Scholarship Application", "Scholarship Inquiry", "Claiming Scholarship Results", "Document Verification (Admission-related)", "Other"],
    "University Registrar's Office (URO)": ["Request for Transcript of Records", "Request for Certificate (Enrollment, Grades, Good Moral, etc.)", "Document Pickup (TOR, Certificates, etc.)", "Correction of Student Records", "Verification of Academic Credentials", "Diploma Request / Release", "Enrollment / Registration Concerns", "Graduation Evaluation", "Other"],
    "Finance and Accounting Office (FAO)": ["Tuition Payment", "Financial Clearance", "Assessment of Fees", "Refund Processing", "Scholarship / Discount Posting Inquiry", "Statement of Account Request", "Official Receipt Concerns", "Payment Discrepancy Inquiry", "Other"],
    "Human Resource Department (HRD)": ["Job Application Submission", "Job Interview", "Employment Verification", "Employee Records Request", "Contract Signing", "HR Consultation / Meeting", "Onboarding / Orientation", "Clearance Processing", "Other"],
    "Property and Supply Office (PSO)": ["Equipment / Asset Request", "Property Issuance / Return", "Inventory Verification", "Lost / Damaged Property Reporting", "Supplies Release / Replenishment", "Other"],
    "Physical Plant Office (PPO)": ["Facility Maintenance Request", "Venue Inspection / Checking", "Campus Infrastructure Concern", "Renovation / Construction Coordination", "Events Setup Coordination", "Other"],
    "ICT / MIS Office": ["Account / System Access Concern", "Network / Internet Issue Reporting", "Laboratory / Equipment Concern", "System Enhancement / Request", "Data / System Support Meeting", "Other"],
    "Purchasing Office": ["Purchase Request Follow-up", "Bidding / Quotation Submission", "Supplier Coordination", "Delivery / Receiving Concerns", "Procurement Status Inquiry", "Other"],
    "Cashier's Office": ["Payment of Fees", "Official Receipt Reprinting", "Refund Claiming", "Petty Cash / Reimbursement", "Collection / Payment Inquiry", "Other"],
    "Internal Audit Office (IAO)": ["Internal Audit Meeting", "Document Submission for Audit", "Compliance / Control Discussion", "Audit Findings Clarification", "Risk Management Consultation", "Other"],

    // üåê EXTERNAL & INSTITUTIONAL OFFICES
    "Institutional Planning and Development Office (IPDO)": ["Institutional Planning Meeting", "Data / Statistics Request", "Strategic Planning Consultation", "Project Proposal Presentation", "Accreditation / Ranking Coordination", "Other"],
    "Networking, Linkages & Relations (NLR)": ["Partnership / MOA Meeting", "Internship / OJT Coordination", "Industry Relations Inquiry", "Sponsorship Meeting", "External Collaboration", "Campus Promotional Activities Coordination", "Other"],
    "Public Relations and Communications Office (PRCO)": ["Media / PR Coordination", "Campus Press / Publication Concern", "Marketing / Branding Meeting", "Social Media / Content Coordination", "Event Coverage Request", "Other"],
    "Quality Assurance Office (QAO)": ["Accreditation / QA Meeting", "Program Evaluation / Monitoring", "Document Submission for QA", "Quality Audit Preparation", "Policy / Standards Consultation", "Other"],
    "Alumni Affairs Office (AAO)": ["Alumni Verification", "Alumni ID Application / Claiming", "Alumni Records Request", "Reunion / Event Coordination", "Campus Access for Alumni", "Donations or Partnerships", "Alumni Networking Inquiries", "Other"],
    "Industry-Academe Linkage Office (IALO)": ["Industry Partnership Meeting", "Internship / OJT Placement", "Company Visit Coordination", "Memorandum of Agreement Discussion", "Job Fair / Recruitment Coordination", "Other"],
    "Technology Business Incubation Office (TBI Office)": ["Startup / Incubation Inquiry", "Mentoring / Coaching Session", "Pitching / Presentation Meeting", "Space / Facility Use Request", "Innovation / IP Consultation", "Other"],

    // üõ° CAMPUS SERVICES
    "Security Office": ["Security Incident Reporting", "Gate / ID Access Concern", "Lost and Found Inquiry", "Event Security Coordination", "Parking / Traffic Concern", "Other"],
    "Clinic / Health Services Office": ["Medical Consultation", "First Aid / Treatment Follow-up", "Medical Certificate Request", "Health Clearance / Requirement", "Vaccination / Health Campaign Visit", "Other"],
    "Maintenance Office": ["Repair / Maintenance Request", "Facility Inspection", "Equipment Servicing", "Cleaning / Sanitation Concern", "Classroom / Office Setup Request", "Other"],
    "Janitorial Services Office": ["Cleaning Request", "Sanitation or Disinfection Concern", "Waste Management / Disposal Inquiry", "Event Cleanup Coordination", "Other"],

    // üèõ EXECUTIVE OFFICES
    "Office of the University President": ["Courtesy Visit", "Official Meeting / Consultation", "Signing of Documents / MOA", "Institutional / External Partnership Meeting", "Award / Recognition Ceremony", "Other"],
    "Office of the Executive Vice President": ["Strategic / Institutional Meeting", "Policy / Implementation Discussion", "Project Monitoring / Evaluation", "Signing of Documents", "Other"],
    "Office of the VP for Academic Affairs (VPAA)": ["Academic Policy Consultation", "Program / Curriculum Meeting", "Accreditation / QA Coordination", "Faculty / Academic Concerns", "Other"],
    "Office of the VP for Administration (VPA)": ["Administrative Policy Consultation", "Facilities / Services Discussion", "HR / Admin Coordination Meeting", "Project / Infrastructure Concerns", "Other"],
    "Office of the VP for Finance (VPF)": ["Budget / Funding Meeting", "Financial Policy Consultation", "Project Costing / Evaluation", "Audit / Compliance Discussion", "Other"],
    "Office of the VP for External Affairs (VPEA)": ["External Relations / Partnership Meeting", "Public / Community Engagement", "Alumni / Industry Collaboration", "Internationalization / Exchange Program Meeting", "Other"]
};

// ===== WARNING MODAL =====
function showWarning(title, message) {
    const warningModal = document.getElementById('warningModal');
    const warningTitle = document.getElementById('warningTitle');
    const warningMessage = document.getElementById('warningMessage');

    if (warningModal) {
        warningTitle.textContent = title;
        warningMessage.textContent = message;
        warningModal.style.display = 'flex';
    }
}

// ===== PURPOSE / OTHER HANDLING =====
function updatePurposeOptions() {
    const departmentSelect = document.getElementById('department');
    const purposeSelect = document.getElementById('purpose');

    if (!departmentSelect || !purposeSelect) return;

    const selectedDepartment = departmentSelect.value;

    // Clear existing options
    purposeSelect.innerHTML = '';

    // If department is "Other", just give a simple dropdown with "Other"
    if (selectedDepartment === 'Other') {
        purposeSelect.style.display = 'block';
        purposeSelect.required = true;

        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'Select Purpose';
        defaultOption.selected = true;
        defaultOption.disabled = true;
        purposeSelect.appendChild(defaultOption);

        const otherOption = document.createElement('option');
        otherOption.value = 'Other';
        otherOption.textContent = 'Other';
        purposeSelect.appendChild(otherOption);

        return;
    }

    // If the department has predefined purposes
    if (selectedDepartment && purposeOptions[selectedDepartment]) {
        purposeSelect.style.display = 'block';
        purposeSelect.required = true;

        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'Select Purpose';
        defaultOption.selected = true;
        defaultOption.disabled = true;
        purposeSelect.appendChild(defaultOption);

        purposeOptions[selectedDepartment].forEach(purpose => {
            const option = document.createElement('option');
            option.value = purpose;
            option.textContent = purpose;
            purposeSelect.appendChild(option);
        });
    } else {
        // No department selected ‚Äì show default message
        purposeSelect.style.display = 'block';
        purposeSelect.required = true;

        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'Select Department First';
        defaultOption.selected = true;
        defaultOption.disabled = true;
        purposeSelect.appendChild(defaultOption);
    }
}

function toggleOther(field) {
    // We only use this for department now
    if (field !== 'department') return;

    const selectEl = document.getElementById(field);
    const otherInput = document.getElementById(field + '_other');

    if (!selectEl || !otherInput) return;

    if (selectEl.value === 'Other') {
        otherInput.style.display = 'block';
        otherInput.required = true;
    } else {
        otherInput.style.display = 'none';
        otherInput.required = false;
        otherInput.value = '';
    }
}

// ===== DATE FORMAT HELPER =====
function formatLocalDate(date) {
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, '0');
    const d = String(date.getDate()).padStart(2, '0');
    return `${y}-${m}-${d}`;
}

// ===== MAIN DOM LOGIC =====
document.addEventListener('DOMContentLoaded', function () {
    const visitDateInput = document.getElementById('visit_date');
    const form = document.querySelector('.booking-form');
    const submitBtn = document.getElementById('submitBtn');

    if (visitDateInput) {
        const baseToday = new Date();          // actual calendar "today"
        baseToday.setHours(0, 0, 0, 0);

        // Max date is always 7 days from *today* (not from min)
        const maxDate = new Date(baseToday);
        maxDate.setDate(maxDate.getDate() + 7);
        const maxStr = formatLocalDate(maxDate);

        // Determine min date based on cutoff
        const now = new Date();
        const cutoffHour = 21; // 9 PM
        const minDate = new Date(baseToday);
        if (now.getHours() >= cutoffHour) {
            // After 9PM: cannot book for *today* anymore, so min is tomorrow
            minDate.setDate(minDate.getDate() + 1);
        }
        const minStr = formatLocalDate(minDate);

        visitDateInput.setAttribute('min', minStr);
        visitDateInput.setAttribute('max', maxStr);

        visitDateInput.addEventListener('input', function () {
            if (!this.value) return;

            const selectedDate = new Date(this.value + 'T00:00:00');
            selectedDate.setHours(0, 0, 0, 0);

            // Recompute now + cutoff on each change so it's always fresh
            const nowCheck = new Date();
            const cutoffHourCheck = 21;
            const todayAtMidnight = new Date();
            todayAtMidnight.setHours(0, 0, 0, 0);

            // If they somehow pick today after 9PM
            if (
                selectedDate.getTime() === todayAtMidnight.getTime() &&
                nowCheck.getHours() >= cutoffHourCheck
            ) {
                showWarning(
                    '‚è∞ Same-day Booking Closed',
                    'Same-day bookings are closed after 9:00 PM. Please choose another date.'
                );
                this.value = '';
                return;
            }

            // Below min date (past or blocked)
            if (selectedDate < minDate) {
                showWarning(
                    'üìÖ Invalid Date',
                    'You cannot select this date. Same-day booking may be closed or the date is in the past.'
                );
                this.value = '';
                return;
            }

            if (selectedDate > maxDate) {
                showWarning('üìÖ Too Far Ahead', 'You can only book up to 7 days in advance.');
                this.value = '';
                return;
            }

            if (selectedDate.getDay() === 0) {
                showWarning(
                    'üìÖ Sunday Not Available',
                    'Visits cannot be scheduled on Sundays. Please select a Monday‚ÄìSaturday date.'
                );
                this.value = '';
            }
        });
    }

    const warningOkBtn = document.getElementById('warningOkBtn');
    if (warningOkBtn) {
        warningOkBtn.onclick = function () {
            const warningModal = document.getElementById('warningModal');
            if (warningModal) warningModal.style.display = 'none';
        };
    }

    if (form) {
        form.addEventListener('submit', function() {
            if (form.checkValidity()) {
                submitBtn.innerHTML = 'Processing...';
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;
            }
        });
    }
});
</script>
{% endblock %}